{% extends "base.html" %}
  {% block body %}
  <div class="container">

    <h5 class="submenu"><i class="fas fa-cog"></i> Config</h5>

    <div class="form-group">
    	<label>Controller Name:</label>
    	<input type="text" class="form-control" name="name" id="name" placeholder="Name of the new config">
    	<small class="form-text text-muted">define a name of this controller</small>
    </div>

    <div class="form-group">
    	<label>Raspberry Port:</label>
    	<input type="text" class="form-control" name="port" id="port" placeholder="GPIO Port">
    	<small class="form-text text-muted">set a number of raspberry GPIO</small>
    </div>

    <div class="form-group">
    	<label>Is it a loop?:</label>
    	<div class="row">
    		<div class="col-sm"><span class="badge badge-pill badge-success handler"><span>ON</span> <i class="fas fa-check"></i></span></div>
    		<div class="col-sm"><label>Repeat time:</label></div>
    		<div class="col-sm"><input type="text" class="form-control" name="repeat_time" id="repeat_time" placeholder="Time in minutes"></div>
    		<div class="col-sm"><label>Duration time:</label></div>
    		<div class="col-sm"><input type="text" class="form-control" name="duration_time" id="duration_time" placeholder="Time in minutes"></div>
    </div>

    <br>
    <div class="form-group">
    	<div class="row">
    		<div class="col center"><button type="button" class="btn btn-success" id="btn_save"><i class="fas fa-check"></i> Save</button></div>
    		<div class="col"><button type="button" class="btn btn-secondary" onclick="location.href='{{ url_for('index')}}';"><i class="fas fa-undo-alt"></i> Back</button></div>
    	</div>
    </div>


    <div id="errorModal" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="fas fa-exclamation-circle text-danger"></i> Alert</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Error: <span id="errorMsg"></span></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /.container -->

  <style type="text/css">
    tr{
      text-align: center;
    }
    .submenu{
      text-align: center;
    }
    .center{
    	text-align: right;
    }
  </style>
  {% endblock %}

  {% block javascript %}
    <script type="text/javascript">
    	$('#btn_save').click(function(){
    		let controller = {
    			name: $('#name').val(),
    			port: $('#port').val(),
    			isLoop: (($('.handler').children().text() == 'ON') ? true : false),
    			repeat_time: $('#repeat_time').val(),
    			duration_time: $('#duration_time').val()
    		};
  			// send
  			if(controller.name !== '' && controller.port !== ''){
	    		$.ajax({
					dataType: 'json',
					contentType: 'application/json',
					url: '/config',
					type: "POST",
	                data: JSON.stringify(controller),
					success: success
				});	
  			} else{
  				let msg = 'Input name and port!';
    			$('#errorMsg').text(msg);
    			$('#errorModal').modal('show');
  			}
    	});

    	function success(json){
    		if(json.return_msg.status == 'SUCCESS'){
    			location.href='{{ url_for('index')}}';
    		}
    		else{
    			let msg = json.return_msg.value;
    			$('#errorMsg').text(msg);
    			$('#errorModal').modal('show');
    			console.log(msg);
    		}
    	}
    </script>
  {% endblock %}